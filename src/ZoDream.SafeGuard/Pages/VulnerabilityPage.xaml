<Page
    x:Class="ZoDream.SafeGuard.Pages.VulnerabilityPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Behaviors="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:bhv="clr-namespace:ZoDream.SafeGuard.Behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sctl="clr-namespace:ZoDream.Shared.Controls;assembly=ZoDream.Shared.Controls"
    xmlns:vm="clr-namespace:ZoDream.SafeGuard.ViewModels"
    Title="漏洞扫描"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary Source="/Themes/ScanStyle.xaml" />
    </Page.Resources>
    <Page.DataContext>
        <vm:VulnViewModel />
    </Page.DataContext>
    <Grid>
        <StackPanel Style="{StaticResource CenterPanel}" Visibility="{Binding Step, Converter={StaticResource ToggleCvt}, ConverterParameter=0}">
            <sctl:IconButton
                Command="{Binding BlackStepCommand}"
                Icon="&#xF6FA;"
                Label="黑盒模式"
                Style="{StaticResource LargeIcon}" />
            <sctl:IconButton
                Command="{Binding WhiteStepCommand}"
                Icon="&#xE773;"
                Label="白盒模式"
                Style="{StaticResource LargeIcon}" />
            <sctl:IconButton
                Command="{Binding LogStepCommand}"
                CommandParameter="iis"
                Icon="&#xE161;"
                Label="IIS日志检测"
                Style="{StaticResource LargeIcon}" />
            <sctl:IconButton
                Command="{Binding LogStepCommand}"
                CommandParameter="apache"
                Icon="&#xE162;"
                Label="Apache日志检测"
                Style="{StaticResource LargeIcon}" />
            <sctl:IconButton
                Command="{Binding LogStepCommand}"
                CommandParameter="nginx"
                Icon="&#xE163;"
                Label="Nginx日志检测"
                Style="{StaticResource LargeIcon}" />
        </StackPanel>

        <!--  黑盒模式  -->
        <Grid Visibility="{Binding Step, Converter={StaticResource ToggleCvt}, ConverterParameter=1}">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <sctl:IconButton
                    Command="{Binding BackCommand}"
                    Icon="&#xE112;"
                    Label="返回" />
                <TextBox
                    Grid.Column="2"
                    MaxLines="1"
                    Text="{Binding BaseUri, Mode=TwoWay}" />
                <sctl:IconButton
                    Grid.Column="3"
                    Command="{Binding StartCommand}"
                    Icon="&#xE11A;"
                    Label="开始扫描" />
            </Grid>
        </Grid>

        <!--  白盒模式  -->
        <Grid Visibility="{Binding Step, Converter={StaticResource ToggleCvt}, ConverterParameter=2}">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <sctl:IconButton
                    Command="{Binding BackCommand}"
                    Icon="&#xE112;"
                    Label="返回" />
                <TextBox
                    Grid.Column="2"
                    MaxLines="1"
                    Text="{Binding BaseUri, Mode=TwoWay}" />
                <sctl:IconButton
                    Grid.Column="3"
                    Command="{Binding StartCommand}"
                    Icon="&#xE11A;"
                    Label="开始扫描" />
            </Grid>

            <GroupBox
                Grid.Row="1"
                AllowDrop="true"
                Header="扫描文件/文件夹">
                <Behaviors:Interaction.Behaviors>
                    <bhv:DragFileBehavior Command="{Binding DragMatchCommand}" />
                </Behaviors:Interaction.Behaviors>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition Height="40" />
                    </Grid.RowDefinitions>
                    <ListBox
                        Background="Transparent"
                        BorderThickness="0"
                        ItemsSource="{Binding MatchFileItems}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button
                                        BorderThickness="0"
                                        Command="{Binding ElementName=root, Path=DataContext.DeleteMatchCommand}"
                                        CommandParameter="{Binding}"
                                        Content="&#xE106;"
                                        Style="{StaticResource IconBtn}"
                                        ToolTip="删除" />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Button
                        Grid.Row="1"
                        Command="{Binding SelectMatchCommand}"
                        Content="&#xE109;"
                        Style="{StaticResource IconBtn}" />
                </Grid>
            </GroupBox>
        </Grid>

        <!--  正式扫描  -->

        <Grid Visibility="{Binding Step, Converter={StaticResource ToggleCvt}, ConverterParameter=3}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <sctl:IconButton
                Command="{Binding BackCommand}"
                Icon="&#xE112;"
                Label="返回"
                Visibility="{Binding IsPaused, Converter={StaticResource ToggleCvt}}" />
            <TextBlock Grid.Column="1" Text="{Binding ProgressTip}" />
            <sctl:IconButton
                Command="{Binding StopCommand}"
                Icon="&#xE112;"
                Label="{Binding StopText}" />
            <ListView Grid.Row="1" Grid.ColumnSpan="3" />
        </Grid>
    </Grid>
</Page>
